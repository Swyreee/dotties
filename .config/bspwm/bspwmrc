#!/bin/bash

# DOTTIES_DIR=$(find $HOME -type d -name "dotties")
# LOCATION=$(curl -s "https://location.services.mozilla.com/v1/geolocate?key=geoclue" -m 10 --connect-timeout 10 | awk 'OFS=":" {print $3,$5}' | tr -d ',}')

LOCATION="10.8326:106.6581"
DOTTIES_DIR="$HOME/dotties"
POLYBAR="polybar -c $HOME/.config/polybar/config.ini"
EWW="eww -c $HOME/.config/eww/hosf"

# Kill processes
killall picom
killall polybar
killall redshift
killall redshift-gtk
killall nm-applet
killall pasystray
killall dunst
killall sxhkd
killall ibus-daemon
killall greenclip
killall eww
killall xfce-polkit
killall xfce4-power-manager
killall flameshot
killall komorebi

# Set wallpaper?
if [ $(cat $HOME/.config/bspwm/wallpaper_mode.txt) == "A" ]
then
    komorebi &
else
    feh --bg-fill $DOTTIES_DIR/assets/desktop.png --no-fehbg
fi

# Start apps
picom &
$POLYBAR top_workspaces &
$POLYBAR top_center &
$POLYBAR top_right &
# $POLYBAR bottom_left &
$POLYBAR bottom_middle &
$POLYBAR bottom_right &
sxhkd -c $HOME/.config/bspwm/sxhkdrc &
$EWW daemon &
redshift-gtk -l $LOCATION &
nm-applet &
pasystray &
flameshot &
dunst &
ibus-daemon -drx &
greenclip daemon &
/usr/lib/xfce-polkit/xfce-polkit &
xfce4-power-manager --daemon

# ================================
bspc monitor -d 1 2 3 4 5 6 7
bspc config window_gap          10

bspc config pointer_action1 move
bspc config pointer_action2 resize_side
bspc config pointer_action2 resize_corner

bspc config split_ratio                 0.5
bspc config remove_disabled_monitors    true
bspc config remove_unplugged_monitors   true
bspc config borderless_monocle          true
bspc config gapless_monocle             true
bspc config focus_by_distance           true
bspc config history_aware_focus         true
bspc config ignore_ewmh_struts          true

bspc config border_width 3
bspc config normal_border_color \#000000
bspc config active_border_color \#F0C674
bspc config focused_border_color \#F0C674

bspc rule -a viewnior       state=floating center=true
bspc rule -a Pavucontrol    state=floating
bspc rule -a Polybar        layer=below manage=off
bspc rule -a Rofi			manage=off
bspc rule -a flameshot      manage=off
